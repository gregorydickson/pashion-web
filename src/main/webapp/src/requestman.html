<!-- requestman.html -->
<template>


    <require from="./common/viewDateFormatter"></require>
    <require from="./common/seasonAbbreviationFormatter"></require>
    <require from="./calendars/datepicker"></require>
    <require from="./contacts/sort"></require>
    <require from="./common/filter"></require>
    <require from="./contacts/range"></require>
    <require from="./dashboard_filters/filters-order"></require>
    <require from="./dashboard_filters/filters-filterrequests"></require>
    <require from="./dashboard_filters/filters-search-from"></require>
    <require from="./dashboard_filters/filters-search-to"></require>
    <require from="./dashboard_filters/filters-city"></require>

    <!-- start preloader -->
    <div class="preloader" show.bind="busy.active" >
        <div class="sk-spinner sk-spinner-wave">
            <div class="sk-rect1"></div>
            <div class="sk-rect2"></div>
            <div class="sk-rect3"></div>
            <div class="sk-rect4"></div>
            <div class="sk-rect5"></div>
        </div>
    </div>
    <!-- end preloader -->



    <!-- Main building block -->
   <!-- <div class="vertical grid-block spa-background">

        
        <compose view-model="header"></compose> 
        
        <div class="grid-block shrink spa-v-spacer ">
        </div> -->
        <div class="grid-block" style="overflow:visible;">
            <!-- -->
            <!-- Request Panel -->
            <!-- -->
            <div id="request-panel" class="grid-block noscroll vertical grid-block-vertical-shadow ">
                <!-- header -->

                <div class="grid-block tool-header shrink ">
                    <div style="margin-left:34px;" class="grid-block tool-header tool-header-spacer"> 
                    </div>
                    <div class="grid-block align-left tool-header-spacer">
                        <span class="ui-text-label-m-broad ">REQUEST MANAGER (${numberOfRequests})</span>
                       <!-- <span class="alert-box">3</span> -->
                    </div>
                    <div class="grid-block align-right tool-header-spacer shrink" style="padding-right:7px;">
                        <span class="expando">
                      <a route-href="route: index;"><img class="expandoHover"  src="/assets/nav/collapso16.png" /></a>
                    </span>
                    </div>
                </div>
                <div class="grid-block">
                    <!-- First Column -->
                    <!-- -->
                    <div class="grid-block vertical">
                        <!-- search and filter requests -->
                        <div class="grid-block shrink" style="margin-left: 1rem; margin-right: 1rem; margin-top:1.5rem;">
                            <div class="grid-block">
                                <!-- Search requests -->
                                <input type="search" value.two-way="searchTextReqMan" class="search-box expandoHover" id="search-requests" placeholder="Search for look number, id, text..." onfocus="this.placeholder = ''" onblur="this.placeholder = 'Search for look number, id, text...'">
                            </div>
                            <div class="grid-block align-center">
                                <!-- filter requests
                                <span class="inline-label">
                                  <span class="form-label" style="height:28px; ">FILTER</span>
                                <select name="" id="" disabled>
                                    <option>All</option>
                                </select>
                                </span> -->

                                <span class="inline-label" style="width:200px;">
                                    <filters-filterrequests change.delegate="filterChange($event)" style="width:200px;"></filters-filterrequests> 
                                </span>


                            </div>
                            <div class="grid-block">
                                <!-- order results
                                <span class="inline-label">
                                  <span class="form-label" style="font-weight: 500">ORDER</span>
                                <select name="" id="">
                                    <option>By Start Date</option>
                                    <option>By Person</option>
                                    <option>By Request ID</option>
                                </select>
                                </span> -->
                                <span class="inline-label" style="width:200px;">
                                    <filters-order change.delegate="orderChange($event)" style="width:200px;"></filters-order> 
                                </span>
                            </div>
                        </div>
                        <div class="grid-block shrink" style="margin-left: 1rem; margin-right: 1rem;">
                            <div class="" style="margin: 0 1rem 2rem 0; height:28px; min-height:28px;">
                                <filters-search-from></filters-search-from>
                            </div>
                            <div class="" style="margin: 0 1rem 2rem 0; height:28px; min-height:28px;">
                                <filters-search-to></filters-search-to>
                            </div>
                            <!-- City -->
                            <!-- is no longer Relvant for categorizing sample requests -->
                            <!-- as move to company based interpretation of onlyShowMine -->
                            <!-- <div if.bind="((user.type === 'brand') || (user.type==='prAgency'))" class="" style="margin: 0 1rem 2rem 0; height:28px; min-height:28px; width:130px;">
                                 <filters-city change.delegate="filterChangeCityRM($event)"></filters-city>
                            </div> -->
                            <div class="grid-content shrink">

                                    <button disabled.bind="(numberOfRequests <= 0)" class="small button hollow" click.delegate="createPDFDialog()">Create PDF</button>

                            </div> 
                        </div>
                        <!-- Accordion -->
                        <!--Header -->
                        
                            <div if.bind="user.type === 'brand'"  class="grid-content shrink" style="overflow-x: hidden; overflow-y: scroll; padding:0; margin-left:1rem; margin-right:1rem; margin-top:1rem;">
                                <table class="big-accordion"  cellspacing="2"  style="table-layout: fixed;">
                                    <tr>
                                        <td class="accordion-underline w3"></td>
                                        <td class="accordion-underline w6">ID</td>
                                        <td class="accordion-underline w10">LOOK</td>
                                        <td class="accordion-underline w13">START DATE</td>
                                        <td class="accordion-underline w13">COMPANY</td>
                                        <td class="accordion-underline w21">REQUESTOR</td>
                                        <td class="accordion-underline w13">END DATE</td>
                                        <td class="accordion-underline w5"><img style="width:19px;" src="/assets/shoppingcart60x47.png" height=47 width=60></img></td>
                                        <td class="accordion-underline w11" style="padding-left:7px;">STATUS</td>
                                        <td class="accordion-underline w5"></td>
                                    </tr>
                                </table>
                            </div>
                            <div if.bind="(user.type === 'press') || (user.type === 'prAgency')"  class="grid-content shrink" style="overflow-x: hidden; overflow-y: scroll; padding:0; margin-left:1rem; margin-right:1rem; margin-top:1rem;">
                                <table class="big-accordion"  cellspacing="2"  style="table-layout: fixed;">
                                    <tr>
                                        <td class="accordion-underline w3"></td>
                                        <td class="accordion-underline w6">ID</td>
                                        <td class="accordion-underline w10">LOOK</td>
                                        <td class="accordion-underline w13">START DATE</td>
                                        <td class="accordion-underline w13">BRAND</td>
                                        <td class="accordion-underline w21">REQUESTOR</td>
                                        <td class="accordion-underline w13">END DATE</td>
                                        <td class="accordion-underline w5"><img style="width:25px;" src="/assets/shoppingcart60x47.png" height=47 width=60></img></td>
                                        <td class="accordion-underline w11" style="padding-left:10px;">STATUS</td>
                                        <td class="accordion-underline w5"></td>
                                    </tr>
                                </table>
                            </div>                            
                            <!-- Content Container-->
                            <!-- Rows of content View-->
                            <div  class="grid-content" style="overflow-x: hidden; overflow-y: scroll; padding:0; margin-left: 1rem; margin-right: 1rem;">
                                
                                <div repeat.for="booking of bookings | sort:ordering:'ascending' | filter:searchTextReqMan:filterFunc:filtering:user:seasons:cityFiltering:onlyShowMine:onlyShowMineCompany
                                | range:searchFrom:searchTo:filterRangeFunc">
                                    <table ref="aBooking"  class="big-accordion" cellspacing="2" style="table-layout: fixed;">
                                        <tr class="brandGridContent indexReqRow">
                                            <td class="accordion-grey w3">
                                                <button id="button${$index}" class="accordion expandoHover" click.delegate="closeExpand($index,booking)"></button>
                                            </td>

                                            <!-- ID -->
                                            <td class="col1 accordion-grey w6">${booking.id}</td>

                                            <!-- Look -->
                                            <td if.bind="user.type === 'brand'" class="col2 accordion-grey w10">${booking.season | seasonAbbreviation:seasons }.${booking.look}</td>
                                            <td if.bind="(user.type === 'press') || (user.type === 'prAgency')" class="col2 accordion-grey w10">${booking.season | seasonAbbreviation:seasons }.${booking.look}</td>

                                            <!-- Start Date -->
                                            <td if.bind="user.type === 'brand'" class="col3 accordion-grey w13 ${computedOverdue(booking.bookingStartDate, booking.requestStatusBrand) ? 'red-deco' : ''} ">${booking.bookingStartDate | viewDateFormat}</td>
                                            <td if.bind="(user.type === 'press') || (user.type === 'prAgency')" class="col3 accordion-grey w13 ${computedOverdue(booking.bookingStartDate, booking.requestStatusPress) ? 'red-deco' : ''} ">${booking.bookingStartDate | viewDateFormat}</td>

                                            <!-- BRAND / Company -->
                                            <td if.bind="(user.type === 'press') || (user.type === 'prAgency')" class="col4 accordion-grey w13 variable-padding">${booking.brand.name}</td>
                                            <td if.bind="user.type === 'brand'" class="col4 accordion-grey w13 variable-padding" ref="company">${booking.requestingUserCompany}</td> <!-- TBD -->

                                            <!-- Requestor -->
                                            <td if.bind="(booking.requestingUser.name) && ((user.type === 'press') || (user.type === 'brand'))" class="col5 accordion-grey w21 variable-padding">${booking.requestingUser.name} ${booking.requestingUser.surname}</td>
                                            <td if.bind="(booking.requestingUser.name) && (user.type === 'prAgency')" class="col5 accordion-grey w21 variable-padding">${booking.requestingUser.name} ${booking.requestingUser.surname} (${booking.requestingUserCompany})</td>

                                            <!-- END DATE -->
                                            <td class="col6 accordion-grey w13 variable-padding ${computedOverdue(booking.bookingEndDate, booking.requestStatusBrand) ? 'red-deco' : ''}">${booking.bookingEndDate | viewDateFormat}</td>

                                            <!-- Items -->
                                            <td class="col7 accordion-grey w5" style="padding-left:11px;">${booking.searchableItems.length}</td>

                                            <!-- Status -->
                                            <td if.bind="(user.type === 'press') || (user.type === 'prAgency')" 
                                                class="col8 accordion-grey w11  
                                                    ${(booking.requestStatusPress=='Pending') ? 'ui-text-label-m-blue' : ''}" style="padding-left:11px;">
                                                    ${booking.requestStatusPress}</td>

                                            <td if.bind="user.type === 'brand'" 
                                                class="col8 accordion-grey w11  
                                                     ${(booking.requestStatusBrand=='Pending') ? 'ui-text-label-m-blue' : ''}" style="padding-left:11px;">
                                                     ${booking.requestStatusBrand}</td>

                                            <td class="accordion-grey w5" style="overflow:visible;"> 
                                                <div class="look-menu-absolute-wrap">
                                                    <!-- ... -->
                                                    <!-- disabled -->
                                                    <span if.bind="(((user.type === 'brand') || (user.type === 'prAgency')) && (booking.requestStatusBrand == 'Deleted'))" class="edit-box disabled" ></span>
                                                    <!-- not disabled -->
                                                    <span if.bind="(((user.type === 'brand')  || (user.type === 'prAgency')) && (booking.requestStatusBrand != 'Deleted'))" class="edit-box" ><a href="#" class="expandoHover" click.delegate="lookEditMenu(booking.id)">...</a></span>

                                                    <!-- ... disabled -->
                                                    <span if.bind="((user.type === 'press') && 
                                                           ((booking.requestStatusPress == 'Denied') ||
                                                            (booking.requestStatusPress == 'Deleted') ||
                                                            (booking.requestStatusPress == 'Returned') ||
                                                            (booking.requestStatusPress == 'Picked Up') ||
                                                            (booking.requestStatusPress == 'Withdrawn') 
                                                            ))" class="edit-box disabled" ></span>
                                                    <!-- ... not disabled -->
                                                    <span if.bind="((user.type === 'press') && 
                                                            ((booking.requestStatusPress != 'Denied') &&
                                                            (booking.requestStatusPress != 'Deleted') &&
                                                            (booking.requestStatusPress != 'Returned') &&
                                                            (booking.requestStatusPress != 'Picked Up') &&
                                                            (booking.requestStatusPress != 'Withdrawn') 
                                                            ))" class="edit-box" ><a href="#" class="expandoHover" click.delegate="lookEditMenu(booking.id)">...</a></span>
                                                    <!-- edit request modal popup -->
                                                     <div class="look-menu-absolute" id="requestManTest${booking.id}">
                                                        <span class="look-menu-heading">REQUEST ${booking.id}</span>
                                                        <ul if.bind="(user.type === 'brand') || (user.type === 'prAgency')"  class="look-menu-list">

                                                            <!-- Edit -->
                                                            <li if.bind="(
                                                                (booking.requestStatusBrand == 'Pending') ||
                                                                (booking.requestStatusBrand == 'Approved') ||
                                                                (booking.requestStatusBrand == 'Returning') ||
                                                                (booking.requestStatusBrand == 'Out') ||
                                                                (booking.requestStatusBrand == 'Picked Up')
                                                            )" 
                                                            class="look-menu-item"><a click.delegate="editSampleRequest(booking.id)" href="#" class="look-menu-link">Edit</a></li>

                                                            <!--Deny -->
                                                            <li if.bind="(
                                                                (booking.requestStatusBrand == 'Pending') ||
                                                                (booking.requestStatusBrand == 'Approved') 
                                                            )"
                                                            class="look-menu-item"><a click.delegate="denySampleRequest(booking.id)" href="#" class="look-menu-link">Deny</a></li>    

                                                            <!-- Approve -->
                                                            <li if.bind="(
                                                                (booking.requestStatusBrand == 'Pending')
                                                            )"
                                                            class="look-menu-item"><a click.delegate="approveSampleRequest(booking.id)" href="#" class="look-menu-link">Approve</a></li>

                                                            <!-- Send 
                                                            <li class="look-menu-item"><a click.delegate="sendSampleRequest(booking.id)" href="#" class="look-menu-link">Send</a></li> -->

                                                            <!-- Picking Up :: Does not exist now, as no "Ship" and too many states
                                                            <li if.bind="(
                                                                (booking.requestStatusBrand == 'Approved') 
                                                            )"
                                                            class="look-menu-item"><a click.delegate="markPickingUpSampleRequest(booking.id)" href="#" class="look-menu-link">Mark Picking Up</a></li> -->

                                                            <!-- Picked Up -->
                                                            <li if.bind="(
                                                                (booking.requestStatusBrand == 'Approved')  
                                                            )"
                                                            class="look-menu-item"><a click.delegate="markPickedUpSampleRequest(booking.id)" href="#" class="look-menu-link">Mark Picked Up</a></li>

                                                            <!-- Returned -->
                                                            <li if.bind="(
                                                                (booking.requestStatusBrand == 'Out') ||
                                                                (booking.requestStatusBrand == 'Picking Up')||
                                                                (booking.requestStatusBrand == 'Picked Up')||
                                                                (booking.requestStatusBrand == 'Returning')
                                                            )"
                                                            class="look-menu-item"><a click.delegate="markReturnedSampleRequest(booking.id)" href="#" class="look-menu-link">Mark Returned</a></li>

                                                            <!-- Restocked -->
                                                            <li if.bind="(
                                                                (booking.requestStatusBrand == 'Returned')
                                                            )"
                                                            class="look-menu-item"><a click.delegate="restockedSampleRequest(booking.id)" href="#" class="look-menu-link">Mark Restocked</a></li>

                                                            <!-- Delete -->
                                                            <li class="look-menu-item"><a click.delegate="deleteSampleRequest($index,booking.id)" href="#" class="look-menu-link">Delete Request</a></li>
                                                        </ul>

                                                        <ul if.bind="(user.type === 'press')" class="look-menu-list">
                                                            <!-- Edit -->
                                                            <li if.bind="(
                                                                (booking.requestStatusPress == 'Pending') ||
                                                                (booking.requestStatusPress == 'In House')||
                                                                (booking.requestStatusPress == 'Approved')
                                                            )"
                                                            class="look-menu-item"><a href="#" click.delegate="editSampleRequest(booking.id)" class="look-menu-link">Edit</a></li>

                                                            <!-- Received -->
                                                            <li if.bind="(
                                                                (booking.requestStatusPress == 'Approved') ||
                                                                (booking.requestStatusPress == 'Delivering')
                                                            )"
                                                            class="look-menu-item"><a href="#" click.delegate="pressMarkReceivedSampleRequest(booking.id)" class="look-menu-link">Mark Received</a></li>

                                                            <!-- Ship :: no longer valid with Stuart changes to edit dialog
                                                            <li class="look-menu-item"><a href="#" click.delegate="pressShipSampleRequest(booking.id)"  class="look-menu-link">Ship</a></li>
                                                            -->

                                                            <!-- Picked Up -->
                                                            <li if.bind="(
                                                                (booking.requestStatusPress == 'In House') 
                                                            )"
                                                            class="look-menu-item"><a href="#" click.delegate="pressMarkPickedUpSampleRequest(booking.id)"  class="look-menu-link">Mark Picked Up</a></li>

                                                            <!-- Withdraw -->
                                                            <li if.bind="(
                                                                (booking.requestStatusPress == 'Pending') ||                                                   
                                                                (booking.requestStatusPress == 'Approved')
                                                            )"
                                                            class="look-menu-item"><a href="#" click.delegate="pressDeleteSampleRequest(booking.id)"  class="look-menu-link">Withdraw Request</a></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </td>

                                        </tr>
                                    </table>

                                    <!-- expanding data -->
                                    <div id="panel${$index}" class="panel grid-block vertical" style="margin-left: 0.5rem; margin-top:1rem;">
                                        <div class="grid-content">
                                            <span class="ui-text-label-m-blue">Delivery Pickup:</span><span style="margin-left:0.5rem;"> ${booking.shippingOut.id} ${booking.shippingOut.tracking}</span>
                                        </div>
                                        <div if.bind="(booking.shippingOut.status!='Proposed')" class="grid-content">
                                            <span class="">${booking.shippingOut.status}</span>
                                            <span> for ${booking.pickupDate | viewDateFormat} ${booking.pickupTime} by ${booking.courierOut} (${booking.paymentOut})</span> 
                                            <span> to </span>
                                            <span if.bind="(booking.deliverTo.pressHouse.name || booking.deliverTo.prAgency.name || booking.deliverTo.brand.name)"> ${booking.deliverTo.pressHouse.name} ${booking.deliverTo.prAgency.name} ${booking.deliverTo.brand.name} at </span>
                                            <span if.bind="booking.addressDestination.address1">${booking.addressDestination.address1}, </span>
                                            <span if.bind="booking.addressDestination.address2"> ${booking.addressDestination.address2}, </span>
                                            <span if.bind="booking.addressDestination.city"> ${booking.addressDestination.city}, </span>
                                            <span if.bind="booking.addressDestination.postalCode"> ${booking.addressDestination.postalCode} </span>
                                            <span if.bind="booking.addressDestination.name"> (${booking.addressDestination.name})</span> 
                                            <span if.bind="booking.pickedupAt"> at ${booking.pickedupAt} </span>
                                            <span if.bind="booking.signedBy"> signed by ${booking.signedBy} </span>
                                        </div>
                                        <div if.bind="(booking.shippingOut.status=='Proposed')" class="grid-content">
                                            <span>TBD</span>
                                        </div>
                                        <div class="grid-content" style="margin-top:1rem;">
                                            <span class="ui-text-label-m-blue">Return Pickup:</span><span style="margin-left:0.5rem;"> ${booking.shippingReturn.id} ${booking.shippingReturn.tracking}</span>
                                        </div>
                                        <div if.bind="(booking.shippingReturn.status!='Proposed')" class="grid-content">
                                            <span class="">${booking.shippingReturn.status}</span>
                                            <span>for ${booking.pickupDateReturn | viewDateFormat} ${booking.pickupTimeReturn} by ${booking.courierReturn} (${booking.paymentReturn}) </span>
                                            <span if.bind="booking.returnToAddress">coming back to ${booking.returnToAddress.name} </span>
                                            <!-- <span if.bind="!booking.returnToAddress">coming back to here</span> -->
                                            <span if.bind="booking.returnToName"> to ${booking.returnToName} ${booking.returnToSurname}</span>
                                            <!-- <span if.bind="!booking.returnToName"> to me</span> -->
                                        </div>
                                        <div if.bind="(booking.shippingReturn.status=='Proposed')" class="grid-content">
                                            <span>TBD</span>
                                        </div>
                                        <div class="grid-content" style="margin-top:1rem;">
                                            <span class="ui-text-label-m-blue">Samples:</span><span style="margin-left:0.5rem;">${booking.searchableItems.length}</span>
                                        </div>
                                        <div class="grid-content" style="margin-bottom: 1rem;">
                                        <!-- with sample images 
                                            <table class="" style="table-layout:fixed;">
                                                <tr  style="height:1rem;">
                                                    <td repeat.for="item of booking.searchableItems" class="accordion"><img if.bind="item.image !== undefined"  src="${item.image}" width="60px;" /></td> 
                                                </tr>
                                                <tr  style="height:1rem;">
                                                    <td repeat.for="item of booking.searchableItems" class="accordion sample-padding">${item.id}: ${item.attributes}</td>
                                                </tr>
                                               <tr>
                                                    <td repeat.for="status of booking.searchableItemsStatus" class="accordion sample-padding">${status.brandStatus}</td>
                                                </tr> 
                                            </table> -->
                                            <!-- no images -->
                                            <table class="" style="table-layout:fixed;">
                                                <tr style="height:1rem;" repeat.for="item of booking.searchableItems" >
                                                    <td if.bind="(user.type === 'brand') && !(item.clientID)" class="accordion sample-padding"> ${booking.season | seasonAbbreviation:seasons }.${look}.${$index+1} &nbsp; : &nbsp; ${item.status.status} &nbsp; :  &nbsp; <span class="to-u-c">${item.attributes}</span></td>
                                                    <td if.bind="(user.type === 'brand') && (item.clientID)" class="accordion sample-padding"> ${booking.season | seasonAbbreviation:seasons }.${look}.${$index+1} &nbsp; [ ${item.clientID} ] &nbsp; : &nbsp; ${item.status.status} &nbsp; : &nbsp; <span class="to-u-c">${item.attributes}</span></td>
                                                    <td if.bind="(user.type === 'press') || (user.type === 'prAgency')"  class="accordion sample-padding">${booking.season | seasonAbbreviation:seasons }.${look}.${$index+1} &nbsp;  : &nbsp;  ${item.status.status} &nbsp;  : &nbsp; <span class="to-u-c">${item.attributes}</span></td>
                                                </tr>
                                            </table>

                                        </div>

                                        <div if.bind="(booking.message)" class="grid-content">
                                            <span class="ui-text-label-m-blue">Notes:</span>
                                        </div>
                                        <div if.bind="(booking.message)"  class="grid-content" style="margin-bottom: 1rem">
                                            <span>${booking.message}</span>
                                        </div>
                                        
                                    </div>
                                </div>  
                                
                                <!-- Empty notice -->
                                <div if.bind="(numberOfRequests == 0)">
                                    <span style="margin-top: 2rem; display:block; text-align:center;"> - No Requests Match Your Search - </span>
                                </div>
                            </div>
                       
                    </div>
                    <!-- spacers -->
                    <div class="grid-block shrink spa-h-spacer">
                    </div>
                    <!-- 2nd Column -->
                    <!-- -->
                    <div id="left-panel" class="vertical grid-block noscroll">
                        <figure style=" display: inline-block; vertical-align: top; text-align:center; margin-top:129px; margin-right: 42px; margin-left: 0px;" >
                            <img class="request-image-fix" src="${image}">
                            <figcaption style="display:block;margin-top:1rem;">
                                <span if.bind="brand" class="accordion-grey" style="font-size: 1.1rem; font-weight: 500;">${brand} LOOK ${look}</span><br>
                                <span class="accordion-grey">${season}</span><br>
                            </figcaption>                           
                        </figure>
                    </div>


                </div>
                <!-- white lip at bottom of scroll region -->
                <div class="grid-content shrink scrolling-lip">
                </div>
            </div>
            <!-- spacer 
            <div class="grid-block shrink spa-h-spacer">
            </div>
            <!-- 
            <!-- Communications Panel  
            <!-- 
            <div id="right-panel" class="vertical grid-block grid-block-vertical-shadow" >
                <!-- Header 
                <compose view-model="comms/commsHeader"></compose>
            </div>
        </div>
        <!-- spacer 
        <div class="grid-content shrink spa-v-spacer">
        </div>
    </div>-->
</template>
