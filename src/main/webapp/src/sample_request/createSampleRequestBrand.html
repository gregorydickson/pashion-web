<template>
<require from="./sort"></require>
<require from="../common/formSelectSampleRequest"></require>
<require from="../common/formSelectSample"></require>
<require from="../common/formSelectObject"></require>
<require from="../common/select-control"></require>
    
   <ai-dialog>
        <ai-dialog-header>
            <!-- header -->
            <div class="grid-block align-center tool-header shrink ">
                <div id="comms_panel" class="grid-block tool-header shrink">
                    <span class="ui-text-label-m-broad">BOOKING&nbsp;${brand.name}
                     <!-- ${currentItem.season.id}&nbsp;-->
                     LOOK&nbsp;</span>
                    <span class="ui-text-label-m-broad">${currentItem.name}</span>
                </div>
            </div>
        </ai-dialog-header>
      <ai-dialog-body> 
        <div class="preloader" if.bind="isLoading" style="min-height:120px;position:relative;top:5px;">
            <div class="sk-spinner sk-spinner-wave">
                <div class="sk-rect1"></div>
                <div class="sk-rect2"></div>
                <div class="sk-rect3"></div>
                <div class="sk-rect4"></div>
                <div class="sk-rect5"></div>
            </div>
        </div>

        <!-- <div class="grid-block">Status: ${status}</div> RM not sure of this attribute for now -->
        <div class="grid-block row" if.bind="!isLoading">
            <!--Start Left column -->
            <div class="vertical grid-block">
                 <div class="grid-block">
                    <span class="calendarnav ui-text-label-m-blue" style="text-align:center;">START BOOKING</span>
                </div>
                <div class="grid-block calendar-header-align">
                     <span click.delegate="startPrevious()" class="calendarnav prev">
                        <a><img src="/assets/calendar/prev.png"  /></a>
                     </span>
                     <span class="calendarnav calendar-title">
                        <a id="titlelink" click.delegate="startReset()">TODAY</a>
                     </span>
                     <span  click.delegate="startNext()" class="calendarnav next">
                        <a><img src="/assets/calendar/next.png" /></a>
                     </span>
                </div>
                <div class="grid-block calendar-header-align">
                    <span class="calendarnav ui-text-label-m-broad monthyear">${startCalendar.calendarMonths[0].monthName}&emsp;${startCalendar.calendarMonths[0].year}</span>
                </div>
                <div class="grid-block  calendar-header-align">
                    <table class="calendar calendar-day-numbers">
                        <thead>
                            <tr>
                                <td repeat.for="cell of startCalendar.calendarMonths[0].dayNames[0]">${cell.dayString}
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr repeat.for="row of startCalendar.calendarMonths[0].rows">
                                <!-- <td class.bind="startCalendar.calendarMonths[0].monthNumber == sampleRequestStartMonth ? 'start-selected' : '' "  repeat.for="cell of row"> -->
                                <!-- <td class.bind="sampleRequestStartDay == cell.dayNumber ? computedClass : '' "  repeat.for="cell of row"> -->
                                <!-- <td class=" ${cell.event==' today' ? ' today' : ''} ${computedClass ? 'start-selected' : 'start-not-selected' }" repeat.for="cell of row"> -->
                               <!--  <td if.bind="startCalendar.calendarMonths[0].monthNumber == sampleRequestStartMonth" class="start-selected"  repeat.for="cell of row">
                                <td if.bind="startCalendar.calendarMonths[0].monthNumber != sampleRequestStartMonth" class=""  repeat.for="cell of row"> -->
                                <td   class= "${cell.event}" repeat.for="cell of row">
                                    <a  class=" ${(computedClass && (cell.dayString === sampleRequestStartDay)) ? 'start-selected' : ''} " href="#" click.delegate="setStartDate($event,cell.event,cell.dayString)">
                                        ${cell.dayString}
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Required By -->
                <div class="grid-content shrink" style="margin-top: 1.5rem;">
                    <span class="inline-label">
                        <span class="slim-text-box-label">Required By</span>
                        <form-select-sr class="to-u-c" name="requiredby" selected.bind="sampleRequest.requiredBy" options.bind="required" ></form-select-sr>
                    </span>
                </div>


                <!-- Deliver To-->
                <div class="grid-content shrink">
                    <span class="inline-label" style="">
                        <span class="slim-text-box-label">Deliver To</span>

                        <select-control ref="selectControl" name="deliverTo"
                            change.delegate="onDeliverToChangeCallback($event)"                      
                            selected.bind="selectedDeliverToItems" 
                            options.bind="availableDeliverToItems" 
                            placeholder="SELECT ONE" 
                            allow_clear="true">
                        </select-control>

                        <!--<form-select-sr class="slim-box" 
                        name="deliverTo" 
                        id="" 
                        selected.two-way="selectedAddress" 
                        options.bind="deliverTo" 
                        change.delegate="deliverToCallback($event)">-->
                            
                        
                        <span class="slim-text-box-label" style="text-align:left"><a click.delegate="addAdHoc()" style="">Add</a></span>
                    </span>
                </div>
 


                <!-- Name-->
                <div class="grid-content shrink">
                    <span class="inline-label" style="margin-bottom: 0px;">
                        <span class="slim-text-box-label" style="">Attention</span>
                        <div>
                            <input type="text" class="slim-text-box" value.bind="selectedAddress.name">
                        </div>
                    </span>
                </div>
                <!-- Company-->
                <div class="grid-content shrink">
                    <span class="inline-label" style="margin-bottom: 0px;">
                        <span class="slim-text-box-label" style="">Phone</span>
                        <div>
                            <input type="text" class="slim-text-box" value.bind="selectedAddress.contactPhone">
                        </div>
                    </span>
                </div>
                <!-- Company-->
                <div class="grid-content shrink">
                    <span class="inline-label" style="margin-bottom: 0px;">
                        <span class="slim-text-box-label" style="">Company</span>
                        <div>
                            <input type="text" class="slim-text-box" value.bind="selectedAddress.company">
                        </div>
                    </span>
                </div>
                <!-- Address 1 -->
                <div class="grid-content shrink">
                    <span class="inline-label" style="margin-bottom: 0px;">
                        <span class="slim-text-box-label" style="">Address 1</span>
                        <div>
                            <input type="text" class="slim-text-box" value.bind="selectedAddress.address1">
                        </div>
                    </span>
                </div>
                <!-- City -->
                <div class="grid-content shrink">
                    <span class="inline-label" style="margin-bottom: 0px;">
                        <span class="slim-text-box-label" style="">City</span>
                        <div>
                            <input type="text" class="slim-text-box" value.bind="selectedAddress.city">
                            </div>
                    </span>
                </div>
                <!-- Country -->
                <div class="grid-content shrink">
                    <span class="inline-label" style="margin-bottom: 0px;">
                        <span class="slim-text-box-label" style="">Country</span>
                        <div>
                            <input type="text" class="slim-text-box" value.bind="selectedAddress.country">
                        </div>
                    </span>
                </div>
                <!-- Postal Code -->
                <div class="grid-content shrink">
                    <span class="inline-label" style="margin-bottom: 0px;">
                        <span class="slim-text-box-label">Postal Code</span>
                        <div> 
                            <input type="text" class="slim-text-box" value.bind="selectedAddress.postalCode">
                        </div>
                    </span>
                </div>
                <!-- Comment  -->
                <div class="grid-content shrink">
                    <span class="inline-label" style="margin-bottom: 0px;">
                        <span class="slim-text-box-label">Comment</span>
                        <div> 
                            <input type="text" class="slim-text-box" value.bind="selectedAddress.comment">
                        </div>
                    </span>
                </div>
                <!-- Courier Section -->
                <div class="grid-content shrink">
                    <span class="inline-label">
                        <span class="slim-text-box-label">Courier</span>
                        <form-select-sr class="to-u-c" name="courierOut" selected.two-way="sampleRequest.courierOut" options.bind="courier" ></form-select-sr>
                    </span>
                </div>

               <!--  split -->
                <div class="grid-content shrink" style="margin-bottom:0.5rem;">
                    <span class="inline-label">
                        <span class=" slim-text-box-label">Split</span>
                        <form-select-sr class="to-u-c" name="paymentOut" selected.two-way="sampleRequest.paymentOut" options.bind="payment" ></form-select-sr>
                    </span>
                </div>                    
                   
                
            </div>
            <!--Start Right column -->
            <div class="vertical grid-block">
                <div class="grid-block shrink">
                    <span class="calendarnav ui-text-label-m-blue" style="text-align:center;">END BOOKING</span>
                </div>
               <div class="grid-block shrink calendar-header-align" >
                  <span click.delegate="endPrevious()" class="calendarnav prev">
                     <a ><img src="/assets/calendar/prev.png"  /></a>
                  </span>
                  <span class="calendarnav calendar-title"><a id="titlelink" click.delegate="endReset()">TODAY</a></span>
                  <span click.delegate="endNext()" class="calendarnav next">
                     <a ><img src="/assets/calendar/next.png" /></a>
                  </span>
               </div>
                <div class="grid-block shrink calendar-header-align">
                    <span class="calendarnav ui-text-label-m-broad monthyear">${endCalendar.calendarMonths[0].monthName}&emsp;${endCalendar.calendarMonths[0].year}</span>
                </div>
                <div class="grid-block shrink calendar-header-align">
                    <table class="calendar calendar-day-numbers">
                        <thead>
                            <tr>
                                <td repeat.for="cell of endCalendar.calendarMonths[0].dayNames[0]">${cell.dayString}
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr repeat.for="row of endCalendar.calendarMonths[0].rows">
                               <!-- <td class="${cell.event}"  repeat.for="cell of row">
                                    <a href="#" click.delegate="setEndDate($event,cell.dayString)">
                                        ${cell.dayString}
                                    </a>
                                </td> -->
                                <td   class= "${cell.event}" repeat.for="cell of row">
                                    <a  class=" ${(computedClassEnd && (cell.dayString === sampleRequestEndDay)) ? 'end-selected' : ''} " href="#" click.delegate="setEndDate($event,cell.event,cell.dayString)">
                                        ${cell.dayString}
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Return By Time -->
                <div class="grid-content shrink" style="margin-top: 1.5rem;">
                    <span class="inline-label">
                        <span class="slim-text-box-label">Return By</span>
                        <form-select-sr class="to-u-c" name="returnBy" selected.bind="sampleRequest.returnBy" options.bind="returnBy" ></form-select-sr>
                    </span>
                </div>    
                            

                <!-- generic drown down used, so no ME. Consider a bespoke one -->
                <div class="grid-content shrink">
                    <span class="inline-label">
                        <span class="slim-text-box-label">Return To</span>

                        <select-control ref="selectControlReturnTo" name="returnToAddress"
                            change.delegate="onReturnToChangeCallback($event)"                      
                            selected.bind="selectedReturnToItems" 
                            options.bind="availableReturnToItems" 
                            placeholder="SELECT ONE" 
                            allow_clear="true">
                        </select-control>
                        <!--<form-select-sr 
                        id="returnTo" class="to-u-c" 
                        name="returnToAddress" 
                        selected.bind="sampleRequest.returnToAddress" 
                        options.bind="brandAddresses" ></form-select-sr>-->
                    </span>
                </div>

                <!-- Courier Section -->
                <div class="grid-content shrink">
                    <span class="inline-label">
                        <span class="slim-text-box-label">Courier</span>
                        <form-select-sr class="to-u-c" name="courierReturn" selected.two-way="sampleRequest.courierReturn" options.bind="courier" ></form-select-sr>
                    </span>
                </div>
                
                <div class="grid-content shrink">
                    <span class="inline-label">
                        <span class=" slim-text-box-label">Split</span>
                         <form-select-sr class="to-u-c" name="paymentReturn" selected.two-way="sampleRequest.paymentReturn" options.bind="payment" ></form-select-sr>
                    </span>
                </div>

                <!--  email -->
                <div class="grid-content shrink" style="margin-bottom:0.5rem;">
                    <span class="inline-label">
                        <span class=" slim-text-box-label">Confirmation</span>
                        <form-select-sr class="to-u-c" name="emailOptions" selected.two-way="email" options.bind="emailOptions" place-holder="NONE"></form-select-sr>
                    </span>
                    <span if.bind="email" class="inline-label">
                        <span class=" slim-text-box-label">Email</span>
                        <input type="text" class="slim-text-box" value.bind="sampleRequest.emailNotification">
                    </span>
                </div>      
                    

            </div>
            <!--end Right column -->
        </div>
        
        <!-- Bottom Row -->  
        <div class="grid-content accordion" if.bind="!isLoading">
            <table class="" style="margin-bottom:4px; table-layout:fixed;">
                    <tr>
                        <td class="accordion" style="width:100px;">SELECT SAMPLES</td>
                        <td class="accordion" style="width:473px;text-align:right; padding-right: 0.5rem;" >Select All</td>
                        <td class="accordion" style="width:10px;">
                            <input type="checkbox" checked.bind="selectAll" change.delegate="allsamples($event)">
                        </td>
                    </tr>
            </table>
        </div>

        <div class="grid-block accordion" style="overflow-x:hidden; max-height:105px;" if.bind="!isLoading"> 
            <div class="grid-content shrink" style="width:88px;">
                <img src="/assets/bg.jpg"  alt="" src.bind="currentItem.image"  style="height:100px;"/> 
            </div>
            <div class="grid-content" >
                <table if.bind="currentItem.samples" class="" style="margin-bottom:0px; table-layout:fixed;" repeat.for="sample of currentItem.samples | sort: 'id': 'ascending'">
                    <tr>
                        
                        <td class="accordion" style="width:35px; max-width:35px;">${currentItem.name}.${$index+1} :&nbsp;</td>
                        <td class="accordion to-u-c" style="width:60px; max-width:60px;">${sample.sampleCity.name}</td>
                        <td class="accordion to-u-c" style="width:389px; max-width:389px; overflow:hidden;">${sample.attributes}</td>
                        <td class="accordion" style="width:10px; max-width:10px;">
                            <input type="checkbox" model.bind="sample.id" change.delegate="updateAvailability()" checked.bind="sampleRequest.samples">
                        </td>
                    </tr>
                </table>
            </div>

        </div>


      </ai-dialog-body>
      <ai-dialog-footer show.bind="!isLoading">
         <a class="hollow button"  click.delegate="close()">Cancel</a>
         <button id="CreateSampleRequestButton" class="button" click.delegate="submit()">Book Selected</button>
      </ai-dialog-footer>
   </ai-dialog>
</template>
